<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gardenicity — fade on baseline → slide to final</title>
<style>
  html,body{margin:0;padding:0;color:#fff;
    font-family:"Acumin Pro",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

  /* CSS vars controlled by JS */
  :root{ --shift: 0px; --titleOpacity: 0; --linksOpacity: 0 }

  /* Fixed hero (never scrolls) */
  .hero-fixed{ position:fixed; inset:0; }

  /* Hero image (800ms fade) */
  .hero-bg{
    position:absolute; inset:0;
    background:url("assets/hero1gc.jpg") center/cover no-repeat;
    opacity:0; animation:heroIn 800ms ease-out forwards;
  }
  @keyframes heroIn{ from{opacity:0} to{opacity:1} }

  /* Media box with your margins: top/bottom 96, left/right 82 */
  .hero-media{
    position:absolute; inset:96px 82px;
    display:flex; align-items:flex-end; justify-content:flex-start;
    overflow:hidden;               /* clip anything below the baseline */
  }

  /* Column moves as a unit via --shift */
  .col{
    position:relative; max-width:700px;
    transform: translateY(var(--shift));
    will-change: transform;
  }

  /* Title: exactly three lines; fades while parked on baseline */
  .hero-title{
    margin:0 0 24px 0;
    font-weight:400; font-size:100px; line-height:100px;
    opacity: var(--titleOpacity); will-change: opacity;
  }
  .hero-title .line{ display:block; }

  /* Links (same column) — start hidden, fade in during slide */
  .hero-links{
    display:flex; flex-direction:column; gap:10px;
    font-size:24px; line-height:30px;
    opacity: var(--linksOpacity);
    transition: opacity .25s linear;
  }
  .hero-links a{ color:#fff; text-decoration:none; border-bottom:1px solid transparent }
  .hero-links a:hover{ border-color: currentColor }

  /* Scroll driver controls the timeline (bigger height → slower) */
  .driver{ height: 200vh; }

  /* Content after */
  .spacer{ min-height:120vh; padding:48px 82px; background:#f5f5f5; color:#000; border-top:1px solid #e5e5e5 }
  .spacer h2{ margin:0 0 12px 0 }
</style>
</head>
<body>

<!-- Fixed hero -->
<div class="hero-fixed">
  <div class="hero-bg" aria-hidden="true"></div>

  <div class="hero-media" id="hero-media">
    <div class="col" id="hero-col">
      <h1 class="hero-title" id="hero-title">
        <span class="line">Gardenicity</span>
        <span class="line">What did</span>
        <span class="line">Geddes see?</span>
      </h1>
      <nav class="hero-links" id="hero-links" aria-label="Primary">
        <a href="#civic-green">Civic Green</a>
        <a href="#growth">Growth</a>
        <a href="#sustenance">Sustenance</a>
        <a href="#leafy-sdgs">Leafy SDGs</a>
        <a href="#lang">EN/עב</a>
      </nav>
    </div>
  </div>
</div>

<!-- Scroll driver (plays Step 2 → Step 3) -->
<section class="driver" id="driver"></section>

<main>
  <section class="spacer">
    <h2 id="civic-green">Next section</h2>
    <p>Placeholder content…</p>
  </section>
</main>

<script>
/*
 - Align to media box bottom (96px above viewport bottom).
 - Wait for fonts, then measure:
     startShift = mediaBottom - (third title line).bottom
     endShift   = mediaBottom - (last link).bottom
 - Progress p = (-driverRect.top) / (driverRect.height - vh)  (0→1)
 - Phases:
     0.00–0.60: title fades on baseline (column parked at startShift)
     0.60–1.00: slide startShift → endShift; links fade 0→1
*/
(function(){
  const driver = document.getElementById('driver');
  const media  = document.getElementById('hero-media');
  const col    = document.getElementById('hero-col');
  const title  = document.getElementById('hero-title');
  const links  = document.getElementById('hero-links');
  if(!driver || !media || !col || !title || !links) return;

  const root  = document.documentElement;
  const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));
  const easeInOutCubic = t => t<0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2;

  // Tiny baseline tweak if needed across devices
  const BASELINE_NUDGE = 0;

  let startShift = 0, endShift = 0;

  function measureShifts(){
    const prev = col.style.transform;
    col.style.transform = 'translateY(0px)';

    const lines = title.querySelectorAll('.line');
    const third = lines[2] || lines[lines.length-1];

    const thirdRect = third.getBoundingClientRect();
    const lastLinkRect = (links.lastElementChild || links).getBoundingClientRect();
    const mediaRect = media.getBoundingClientRect();

    const mediaBaseline = mediaRect.bottom + BASELINE_NUDGE;

    startShift = mediaBaseline - thirdRect.bottom;
    endShift   = mediaBaseline - lastLinkRect.bottom;

    col.style.transform = prev || '';
    root.style.setProperty('--shift', startShift.toFixed(1)+'px');
  }

  function progress(){
    const r  = driver.getBoundingClientRect();
    const vh = window.innerHeight || document.documentElement.clientHeight;
    const total = r.height - vh;
    if (total <= 0) return 1;
    return clamp(-r.top / total, 0, 1);
  }

  function update(){
    const p = progress();

    // Step 2: slow/soft fade on baseline
    const pFade = easeInOutCubic( clamp(p / 0.60, 0, 1) );
    root.style.setProperty('--titleOpacity', pFade.toFixed(3));

    // Step 3: slide to final + reveal links
    const pSlide = clamp((p - 0.60) / 0.40, 0, 1);
    const shift  = startShift + (endShift - startShift) * pSlide;
    root.style.setProperty('--shift', shift.toFixed(1)+'px');
    root.style.setProperty('--linksOpacity', pSlide.toFixed(3));
  }

  async function init(){
    if (document.fonts && document.fonts.ready) {
      try { await document.fonts.ready; } catch(e){}
    }
    measureShifts();
    update();

    window.addEventListener('load',   ()=>{ measureShifts(); update(); });
    window.addEventListener('resize', ()=>{ measureShifts(); update(); });
    window.addEventListener('scroll', update, { passive:true });
  }

  init();
})();
</script>
</body>
</html>
