function update(){
  /* HERO (unchanged) */
  const p=progressOf(driver);
  const pFade=easeInOutCubic(Math.max(0, Math.min(1, p/0.60)));
  root.style.setProperty('--titleOpacity',pFade.toFixed(3));
  const pSlide=Math.max(0, Math.min(1, (p-0.60)/0.40));
  const shift=startShift+(endShift-startShift)*pSlide;
  root.style.setProperty('--shift',shift.toFixed(1)+'px');
  root.style.setProperty('--linksOpacity',pSlide.toFixed(3));

  /* Section progress */
  const s1 = progressOf(s1Wrap);
  const s2 = progressOf(s2Wrap);
  root.style.setProperty('--s1',s1.toFixed(3));
  root.style.setProperty('--s2',s2.toFixed(3));

  /* Show overlays only when active (gate S2 until S1 is done) */
  root.style.setProperty('--s1Overlay', (s1>0 && s1<1) ? 1 : 0);
  root.style.setProperty('--s2Overlay', (s1>=1 && s2>0 && s2<1) ? 1 : 0);

  /* Dissolve hero while S1 arrives */
  root.style.setProperty('--heroAlpha',(1-s1).toFixed(3));
  root.style.setProperty('--heroBlur',(s1*0.8).toFixed(3));

  /* ---------- TEXT SWEEP (compute Y first; used by fade logic) ---------- */
  // S1 text
  const s1TextStart=0.75;
  const s1Raw=Math.max(0, Math.min(1, (s1-s1TextStart)/(1-s1TextStart)));
  const s1Y = s1StartY + (s1EndY - s1StartY) * Math.pow(s1Raw, 0.8);
  root.style.setProperty('--s1Y', s1Y+'px');

  // S2 text
  const s2TextStart=0.25;
  const s2Raw=Math.max(0, Math.min(1, (s2-s2TextStart)/(1-s2TextStart)));
  const s2Y = s2StartY + (s2EndY - s2StartY) * Math.pow(s2Raw, 0.8);
  root.style.setProperty('--s2Y', s2Y+'px');

  /* ---------- IMAGE FADES ---------- */
  // S1 fade IN (same as before)
  const s1In = Math.max(0, Math.min(1, s1/0.35));

  // S1 fade OUT starts when text bottom reaches 75% vh OR clears top
  const clipH = window.innerHeight;
  const textH = s1Text.scrollHeight;
  const textBottom = s1Y + textH;          // px from top of viewport
  const thresh = 0.75 * clipH;             // 75% viewport height
  // Map textBottom: thresh → 0  ==>  0 → 1
  let s1Out = 0;
  if (textBottom <= thresh) {
    s1Out = (thresh - Math.max(textBottom, 0)) / Math.max(thresh, 1);
    s1Out = Math.max(0, Math.min(1, s1Out));
  }
  const s1Alpha = (1 - s1Out) * s1In;
  root.style.setProperty('--s1ImgOpacity', s1Alpha.toFixed(3));

  // S2 fade IN (gated so it never starts before S1 is fully gone)
  const gate = (s1Alpha <= 0.001) ? 1 : 0;
  const s2In = Math.max(0, Math.min(1, s2/0.25));
  const s2Alpha = gate * s2In;
  root.style.setProperty('--s2ImgOpacity', s2Alpha.toFixed(3));
}
